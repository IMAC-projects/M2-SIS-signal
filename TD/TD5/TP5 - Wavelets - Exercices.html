
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>TD5 - Wavelets &#8212; M2 Signal classes</title>
    
  <link rel="stylesheet" href="../../_static/css/index.73d71520a4ca3b99cfee5594769eaaae.css">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="../../_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="../../_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/sphinx-book-theme.40e2e510f6b7d1648584402491bb10fe.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../../_static/js/index.3da636dd464baa7582d2.js">

    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/togglebutton.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/sphinx-book-theme.d31b09fe5c1d09cb49b26a786de4a05d.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Inverse Problem" href="../TD6/Inverse-Problem.html" />
    <link rel="prev" title="TD4 - Spectral Analysis and Filtering" href="../TD4/TP4%20-%20Spectral%20Analysis%20and%20Filtering-Exercise.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../../index.html">
  
  <img src="../../_static/logo.png" class="logo" alt="logo">
  
  
  <h1 class="site-logo" id="site-title">M2 Signal classes</h1>
  
</a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>
<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../../Introduction/Introduction.html">
   Introduction
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Fourier
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../../Transform%C3%A9e%20de%20Fourier/Transform%C3%A9e%20de%20Fourier.html">
   Transformée de Fourier
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Filtrage
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../../Filtrage/Filtre.html">
   Filtre
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../Filtrage/D%C3%A9bruitage.html">
   Débruitage
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Compression
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../../Compression/Compression.html">
   Compression
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../Compression/Le%20cas%20du%20JPEG.html">
   Le cas du JPEG
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../Compression/Ondelettes.html">
   Ondelettes
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  TD
 </span>
</p>
<ul class="current nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../TD1/TP1%20-%20EEA%20-%20Exercices.html">
   TD1 - Analyse en fréquence de signaux sonores.
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../TD2/TP2%20-%20FFT%20-%20Exercices.html">
   TD2 - FFT
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../TD3/TP3%20-%20Compression%20Shannon-Huffman-Exercises.html">
   TD3 - Compression Shannon-Huffman
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../TD4/TP4%20-%20Spectral%20Analysis%20and%20Filtering-Exercise.html">
   TD4 - Spectral Analysis and Filtering
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   TD5 - Wavelets
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../TD6/Inverse-Problem.html">
   Inverse Problem
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../TD6/TP6%20-%20Denoising-Exercices.html">
   TD6 - Denoising
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../TD7/TP7%20-%20Optimization.html">
   TD7 - Optimization
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../TD8/TP8%20-%20Non-local%20means-exercises.html">
   TD8 - Non-local means
  </a>
 </li>
</ul>

</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
            data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
            aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
            title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../_sources/TD/TD5/TP5 - Wavelets - Exercices.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

        <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/IMAC-projects/M2-SIS-signal"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/IMAC-projects/M2-SIS-signal/issues/new?title=Issue%20on%20page%20%2FTD/TD5/TP5 - Wavelets - Exercices.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>


        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
                title="Fullscreen mode"><i
                    class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/IMAC-projects/M2-SIS-signal/master?urlpath=tree/TD/TD5/TP5 - Wavelets - Exercices.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

    </div>

    <!-- Table of contents -->
    <div class="d-none d-md-block col-md-2 bd-toc show">
        
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i> Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#q1-test-that-the-subsampling-and-upsampling-operators-defined-below-are-adjoint-operators">
   Q1: Test that the subsampling and upsampling operators defined below are adjoint operators.
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#q2-implement-below-the-one-step-of-w-transform-of-the-lecture-coarse-and-fine-scale-transforms-and-test-it-on-your-image">
   Q2: Implement below the one step of W transform of the lecture. Coarse and Fine scale transforms and test it on your image.
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#q3-implement-the-full-fast-wavelet-transform-for-a-given-number-of-scales">
   Q3: Implement the full fast wavelet transform for a given number of scales.
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#q4-below-are-functions-to-obtain-a-better-plot-of-the-results-using-the-functions-below-plot-the-wavelet-transform">
   Q4: Below are functions to obtain a better plot of the results. Using the functions below, plot the wavelet transform.
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#q5-the-wavelet-transform-is-an-orthogonal-transformation-so-its-inverse-is-given-by-its-transpose-also-called-adjoint-use-the-two-operators-defined-below-to-implement-the-inverse-of-the-wavelet-transform">
   Q5: The wavelet transform is an orthogonal transformation so its inverse is given by its transpose (also called adjoint). Use the two operators defined below to implement the inverse of the wavelet transform.
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#q6-test-on-an-image-that-the-implemented-inverse-is-correct-that-is-check-on-an-image-x-that-iwt-text-wavelettransform-x-x-up-to-numerical-errors">
   Q6: Test on an image that the implemented inverse is correct. That is, check on an image
   <span class="math notranslate nohighlight">
    \(x\)
   </span>
   that
   <span class="math notranslate nohighlight">
    \(IWT(\text{WaveletTransform(x)}) = x\)
   </span>
   up to numerical errors.
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#q7-plot-the-histogram-of-the-wavelet-coefficients-just-to-see-the-repartition-between-small-and-large-coefficients-by-modifying-the-code-below-you-should-see-that-most-of-the-coefficients-are-close-to-0-and-few-are-large-coefficients-thus-the-idea-is-that-lossy-compression-might-perform-well-on-this-data">
   Q7: Plot the histogram of the wavelet coefficients just to see the repartition between small and large coefficients by modifying the code below. You should see that most of the coefficients are close to
   <span class="math notranslate nohighlight">
    \(0\)
   </span>
   and few are large coefficients. Thus, the idea is that lossy compression might perform well on this data.
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#q8-consider-the-20-largest-coefficients-of-the-wavelet-transform-and-put-all-the-remaining-coefficients-to-0-and-show-the-resulting-approximating-image">
   Q8: Consider the 20% largest coefficients of the wavelet transform and put all the remaining coefficients to
   <span class="math notranslate nohighlight">
    \(0\)
   </span>
   and show the resulting approximating image.
  </a>
 </li>
</ul>

        </nav>
        
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="td5-wavelets">
<h1>TD5 - Wavelets<a class="headerlink" href="#td5-wavelets" title="Permalink to this headline">¶</a></h1>
<p>In this TD, we study the wavelet decomposition using the Daubechies 4 filters.</p>
<p>Hereafter, we compute a multiscale decomposition in the spirit of wavelets using Fourier.</p>
<p>We are looking for a linear operator</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{align}
W: \,&amp;\mathbb{C}^N \to \mathbb{C}^{N_1} \times \ldots \times \mathbb{C}^{N_2}\\
&amp;u_0 \mapsto (u_0,\ldots,u_n)\,,
\end{align}
\end{split}\]</div>
<p>which is an isometry which means:</p>
<div class="math notranslate nohighlight">
\[
\begin{equation}
\forall u \in \mathbb{C}^{N_0}, \| u \|_2 = \| Wu\|_2
\end{equation}
\]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">division</span>
<span class="c1">#from scipy.misc import imsave</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">scipy</span> <span class="k">as</span> <span class="nn">sp</span>
<span class="kn">import</span> <span class="nn">scipy.fftpack</span> <span class="k">as</span> <span class="nn">ft</span>
<span class="o">%</span><span class="k">pylab</span> inline
<span class="o">%</span><span class="k">matplotlib</span> inline
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Populating the interactive namespace from numpy and matplotlib
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># load an image</span>
<span class="kn">import</span> <span class="nn">imageio</span> <span class="k">as</span> <span class="nn">imio</span>
<span class="n">colored_image</span> <span class="o">=</span> <span class="n">imio</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="s1">&#39;grumpycat.png&#39;</span><span class="p">)</span>
<span class="n">n</span> <span class="o">=</span> <span class="mi">220</span>
<span class="n">image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">colored_image</span><span class="o">*</span><span class="p">[</span><span class="mf">0.21</span><span class="p">,</span> <span class="mf">0.72</span> <span class="p">,</span><span class="mf">0.07</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gray</span><span class="p">()</span>
<span class="n">cropped</span> <span class="o">=</span> <span class="n">image</span><span class="p">[</span><span class="n">n</span><span class="p">:</span><span class="n">n</span><span class="o">+</span><span class="mi">1024</span><span class="p">,</span><span class="n">n</span><span class="p">:</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1024</span><span class="p">]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot; Grey Level Image &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">cropped</span><span class="p">)))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">cropped</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">cropped</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">cropped</span><span class="p">),(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">cropped</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">image0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>118.3223597049713 46.019983171402444 28.049999999999997
(1720, 1720)
</pre></div>
</div>
<img alt="../../_images/TP5 - Wavelets - Exercices_3_1.png" src="../../_images/TP5 - Wavelets - Exercices_3_1.png" />
</div>
</div>
<p>What are the conditions on the filters for being admissible wavelet filters: The first condition on the low-pass filter <span class="math notranslate nohighlight">\(h\)</span> is</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{equation} \begin{cases}|\hat{h}(\omega)|^2 + |\hat{h}(\omega + \frac 12)|^2 = 2\\\hat{h}(0) = \sqrt{2}\,.\end{cases}\end{equation}
\end{split}\]</div>
<p>The condition on the high-pass filter is the following:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{equation} \begin{cases}|\hat{g}(\omega)|^2 + |\hat{g}(\omega + \frac 12)|^2 = 2\\\hat{g}(\omega) \hat{h}^*(\omega)+ \hat{g}(\omega + \frac 12)\hat{h}^*(\omega + \frac 12) = 0\,.\end{cases}
\end{equation}
\end{split}\]</div>
<p>It is possible to find this condition by writing the orthogonality condition of the scaling function and the wavelet function at scale 0 and scale 1. It is similar to the computation presented in the previous lecture.</p>
<p>Below are given the 4-Daubechies filters: the filter h corresponds to the low pass filter and the filter g corresponds to the high-pass filter. This filter is designed so that the first two moments of the wavelet function vanish. Thus, it encodes more efficiently parts of the image which have a behaviour close to a polynomial function of degree 2.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">h</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="o">.</span><span class="mi">482962913145</span><span class="p">,</span> <span class="o">.</span><span class="mi">836516303738</span><span class="p">,</span> <span class="o">.</span><span class="mi">224143868042</span><span class="p">,</span> <span class="o">-.</span><span class="mi">129409522551</span><span class="p">]</span>
<span class="n">h</span> <span class="o">=</span> <span class="n">h</span><span class="o">/</span><span class="n">norm</span><span class="p">(</span><span class="n">h</span><span class="p">)</span> <span class="c1">## make sure the filter has norm 1.</span>
<span class="n">u</span> <span class="o">=</span> <span class="n">power</span><span class="p">(</span><span class="o">-</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">h</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">h</span><span class="p">)))</span> <span class="c1"># alternate +1/-1</span>
<span class="n">g</span> <span class="o">=</span> <span class="n">concatenate</span><span class="p">(([</span><span class="mi">0</span><span class="p">],</span><span class="n">h</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">u</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;low-pass filter associated with the scaling function&quot;</span><span class="p">,</span><span class="n">h</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;high-pass filter associated with the wavelet function&quot;</span><span class="p">,</span><span class="n">g</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>low-pass filter associated with the scaling function [ 0.          0.48296291  0.8365163   0.22414387 -0.12940952]
high-pass filter associated with the wavelet function [ 0.          0.12940952  0.22414387 -0.8365163   0.48296291]
</pre></div>
</div>
</div>
</div>
<p>We choose below periodic boundary condition for the filtering which is the simplest condition one can use. More involved treatment of the boundaries have been developed.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Below is a circular convolution implemented. </span>
<span class="k">def</span> <span class="nf">cconv</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">d</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">cconv</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">h</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="n">p</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
    <span class="n">pc</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">((</span><span class="n">p</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="p">)))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">y</span> <span class="o">+</span> <span class="n">h</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">pc</span><span class="o">-</span><span class="n">i</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">y</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="q1-test-that-the-subsampling-and-upsampling-operators-defined-below-are-adjoint-operators">
<h2>Q1: Test that the subsampling and upsampling operators defined below are adjoint operators.<a class="headerlink" href="#q1-test-that-the-subsampling-and-upsampling-operators-defined-below-are-adjoint-operators" title="Permalink to this headline">¶</a></h2>
<p>That is, you test on random vectors that the following equality holds: <span class="math notranslate nohighlight">\(\langle \text{subsampling}(x),y \rangle = \langle \text{upsampling}(y),x \rangle\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">subsampling</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
    <span class="n">p</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="k">if</span> <span class="n">d</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">x</span><span class="p">[::</span><span class="n">p</span><span class="p">,</span> <span class="p">:]</span>
    <span class="k">elif</span> <span class="n">d</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">x</span><span class="p">[:,</span> <span class="p">::</span><span class="n">p</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">y</span>


<span class="k">def</span> <span class="nf">upsampling</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
    <span class="n">p</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span>
    <span class="k">if</span> <span class="n">d</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">p</span> <span class="o">*</span> <span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">y</span><span class="p">[::</span><span class="n">p</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">x</span>
    <span class="k">elif</span> <span class="n">d</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p</span> <span class="o">*</span> <span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">y</span><span class="p">[:,</span> <span class="p">::</span><span class="n">p</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span>
    <span class="k">return</span> <span class="n">y</span>

<span class="k">def</span> <span class="nf">reverse</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

<span class="n">N</span> <span class="o">=</span> <span class="mi">16</span>
<span class="n">EPSILON</span> <span class="o">=</span> <span class="mf">1e-12</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">N</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="n">N</span><span class="p">)</span>
<span class="n">d</span> <span class="o">=</span> <span class="mi">0</span>
<span class="c1">#np.vdot returns the dot product of two vectors.</span>
<span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">vdot</span><span class="p">(</span><span class="n">subsampling</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">d</span><span class="p">),</span> <span class="n">y</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">vdot</span><span class="p">(</span><span class="n">upsampling</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">d</span><span class="p">),</span> <span class="n">x</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">vdot</span><span class="p">(</span><span class="n">subsampling</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">d</span><span class="p">),</span> <span class="n">y</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">vdot</span><span class="p">(</span><span class="n">upsampling</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">x</span><span class="p">))</span> <span class="o">&lt;</span> <span class="n">EPSILON</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>34.09154744633541
34.09154744633541
True
</pre></div>
</div>
</div>
</div>
<p>In order to extend the wavelet transform in 2D on images, simply perform the wavelet transform iteratively on the dimension of the image.</p>
<p>First choose for instance, the lines of the image and perform wavelet transform thus obtaining <span class="math notranslate nohighlight">\(low scale(0)\)</span> and <span class="math notranslate nohighlight">\(high scale(0)\)</span> on the lines (0 is the index for the lines and 1 for the columns).</p>
<p>Then, you apply again the wavelet transform in the other direction, let’s say the columns, for each part of the transformed signal.</p>
<p>Thus, you obtain: <span class="math notranslate nohighlight">\(high scale(1)(low scale(0))\)</span> and <span class="math notranslate nohighlight">\(high scale(1)(high scale(0))\)</span> and  <span class="math notranslate nohighlight">\(low scale(1)(high scale(0))\)</span> and <span class="math notranslate nohighlight">\(low scale(1)(low scale(0))\)</span>.</p>
<p>You thus have four parts for the 1 step wavelet transform for a given image.</p>
<p>It is usually concatenated in an array of this type: <span class="math notranslate nohighlight">\(\begin{pmatrix} LL &amp; HL \\ LH &amp; HH\end{pmatrix}\)</span> where <span class="math notranslate nohighlight">\(L\)</span> and <span class="math notranslate nohighlight">\(H\)</span> represent respectively low and high scale.</p>
</div>
<div class="section" id="q2-implement-below-the-one-step-of-w-transform-of-the-lecture-coarse-and-fine-scale-transforms-and-test-it-on-your-image">
<h2>Q2: Implement below the one step of W transform of the lecture. Coarse and Fine scale transforms and test it on your image.<a class="headerlink" href="#q2-implement-below-the-one-step-of-w-transform-of-the-lecture-coarse-and-fine-scale-transforms-and-test-it-on-your-image" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#https://pywavelets.readthedocs.io/en/latest/</span>
<span class="c1">#http://gwyddion.net/documentation/user-guide-en/wavelet-transform.html</span>

<span class="k">def</span> <span class="nf">coarse</span><span class="p">(</span><span class="n">image</span><span class="p">,</span><span class="n">d</span><span class="p">):</span> <span class="c1">#coarse means &quot;harsh&quot;</span>
    <span class="c1"># d is the dimension along which the operation is performed.</span>
    <span class="c1"># the formula to be implemented is the convolution of x by h along the dimension d.</span>
    <span class="n">coarse</span> <span class="o">=</span> <span class="n">cconv</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span>
    <span class="n">coarse</span> <span class="o">=</span> <span class="n">subsampling</span><span class="p">(</span><span class="n">coarse</span><span class="p">,</span><span class="n">d</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">coarse</span>

<span class="k">def</span> <span class="nf">fine</span><span class="p">(</span><span class="n">image</span><span class="p">,</span><span class="n">d</span><span class="p">):</span>
    <span class="c1"># d is the dimension along which the operation is performed.</span>
    <span class="c1"># the formula to be implemented is the convolution of x by g along the dimension d.</span>
    <span class="n">fine</span> <span class="o">=</span> <span class="n">cconv</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span>
    <span class="n">fine</span> <span class="o">=</span> <span class="n">subsampling</span><span class="p">(</span><span class="n">fine</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">fine</span>

<span class="k">def</span> <span class="nf">W_0</span><span class="p">(</span><span class="n">image</span><span class="p">,</span><span class="n">wavelet_coeff</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="c1"># start with the first dimension index 0 to get coarse and fine description along this axis</span>
    <span class="c1">#lowscale and highscale</span>
    <span class="n">l0</span> <span class="o">=</span> <span class="n">coarse</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">h0</span> <span class="o">=</span> <span class="n">fine</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="c1"># process again the previous results to get coarse and fine description along the axis of index 1.</span>
    <span class="c1"># you thus should have 4 sub-images of the same size which is the initial image size divided by 4 (divide columns and rows by 2).</span>
    <span class="n">LL</span> <span class="o">=</span> <span class="n">coarse</span><span class="p">(</span><span class="n">l0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">HL</span> <span class="o">=</span> <span class="n">fine</span><span class="p">(</span><span class="n">l0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">LH</span> <span class="o">=</span> <span class="n">coarse</span><span class="p">(</span><span class="n">h0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">HH</span> <span class="o">=</span> <span class="n">fine</span><span class="p">(</span><span class="n">h0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="c1"># concatenate your results in an array called results</span>
    <span class="n">L</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">LL</span><span class="p">,</span> <span class="n">LH</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">H</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">HL</span><span class="p">,</span> <span class="n">HH</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">L</span><span class="p">,</span> <span class="n">H</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>

<span class="nb">print</span><span class="p">(</span><span class="n">W_0</span><span class="p">(</span><span class="n">image</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[[ 2.01740000e+02  2.01740000e+02  2.01740000e+02 ...  0.00000000e+00
   0.00000000e+00  0.00000000e+00]
 [ 2.01740000e+02  2.01740000e+02  2.01740000e+02 ...  0.00000000e+00
   0.00000000e+00  0.00000000e+00]
 [ 2.01740000e+02  2.01740000e+02  2.01740000e+02 ...  0.00000000e+00
   0.00000000e+00  0.00000000e+00]
 ...
 [-1.00485917e-14 -1.00485917e-14 -1.00485917e-14 ...  0.00000000e+00
   0.00000000e+00  0.00000000e+00]
 [-1.00485917e-14 -1.00485917e-14 -1.00485917e-14 ...  0.00000000e+00
   0.00000000e+00  0.00000000e+00]
 [-1.00485917e-14 -1.00485917e-14 -1.00485917e-14 ...  0.00000000e+00
   0.00000000e+00  0.00000000e+00]]
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="q3-implement-the-full-fast-wavelet-transform-for-a-given-number-of-scales">
<h2>Q3: Implement the full fast wavelet transform for a given number of scales.<a class="headerlink" href="#q3-implement-the-full-fast-wavelet-transform-for-a-given-number-of-scales" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">WaveletTransform</span><span class="p">(</span><span class="n">image</span><span class="p">,</span><span class="n">iterations</span> <span class="o">=</span> <span class="mi">1</span><span class="p">):</span>
    <span class="c1">## iterate the 1step wavelet transform implemented above.</span>
    <span class="c1"># first step is W_0</span>
    <span class="k">if</span> <span class="n">iterations</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">image</span>
    <span class="n">waveletTransform</span> <span class="o">=</span> <span class="n">W_0</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
    <span class="n">size</span> <span class="o">=</span> <span class="n">waveletTransform</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">waveletTmp</span> <span class="o">=</span> <span class="n">waveletTransform</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">size</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">size</span><span class="p">]</span>
    <span class="n">waveletTransform</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">size</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">size</span><span class="p">]</span> <span class="o">=</span> <span class="n">WaveletTransform</span><span class="p">(</span><span class="n">waveletTmp</span><span class="p">,</span><span class="n">iterations</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">waveletTransform</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="q4-below-are-functions-to-obtain-a-better-plot-of-the-results-using-the-functions-below-plot-the-wavelet-transform">
<h2>Q4: Below are functions to obtain a better plot of the results. Using the functions below, plot the wavelet transform.<a class="headerlink" href="#q4-below-are-functions-to-obtain-a-better-plot-of-the-results-using-the-functions-below-plot-the-wavelet-transform" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">rescale</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="n">a</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">b</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="c1">## function that rescale f between a and b.</span>
    <span class="n">rang</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">f</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
    <span class="n">g</span> <span class="o">=</span> <span class="p">(</span><span class="n">f</span> <span class="o">-</span> <span class="n">f</span><span class="o">.</span><span class="n">min</span><span class="p">())</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">rang</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">g</span> <span class="o">/</span> <span class="n">rang</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">g</span><span class="o">*</span><span class="p">(</span><span class="n">b</span><span class="o">-</span><span class="n">a</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">rescaleWav</span><span class="p">(</span><span class="n">A</span><span class="p">):</span>
    <span class="c1">## function dedicated to a proper rescale of wavelet representation (particular case of the previous one).</span>
    <span class="n">sup</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">A</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="n">B</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">sup</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">B</span> <span class="o">=</span> <span class="o">.</span><span class="mi">5</span> <span class="o">+</span> <span class="o">.</span><span class="mi">5</span> <span class="o">*</span> <span class="n">A</span> <span class="o">/</span> <span class="n">sup</span>
    <span class="k">return</span> <span class="n">B</span>
    
<span class="k">def</span> <span class="nf">PlotWavelet</span><span class="p">(</span><span class="n">wavelet</span><span class="p">,</span> <span class="n">iterations</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="c1">## Plot the wavelet representation, need to specify the number of iterations (or scales at which the FWT is computed).</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">wavelet</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">Jmax</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="n">n</span><span class="p">))</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">Jmin</span> <span class="o">=</span> <span class="n">Jmax</span> <span class="o">-</span> <span class="n">iterations</span> <span class="o">+</span> <span class="mi">1</span>
    
    <span class="n">U</span> <span class="o">=</span> <span class="n">wavelet</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">Jmax</span><span class="p">,</span> <span class="n">Jmin</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">U</span><span class="p">[:</span><span class="mi">2</span> <span class="o">**</span> <span class="n">j</span><span class="p">:,</span>    <span class="mi">2</span> <span class="o">**</span> <span class="n">j</span><span class="p">:</span><span class="mi">2</span> <span class="o">**</span>
            <span class="p">(</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):]</span> <span class="o">=</span> <span class="n">rescaleWav</span><span class="p">(</span><span class="n">U</span><span class="p">[:</span><span class="mi">2</span> <span class="o">**</span> <span class="n">j</span><span class="p">:,</span> <span class="mi">2</span> <span class="o">**</span> <span class="n">j</span><span class="p">:</span><span class="mi">2</span> <span class="o">**</span> <span class="p">(</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):])</span>
        <span class="n">U</span><span class="p">[</span><span class="mi">2</span> <span class="o">**</span> <span class="n">j</span><span class="p">:</span><span class="mi">2</span> <span class="o">**</span> <span class="p">(</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):,</span> <span class="p">:</span><span class="mi">2</span> <span class="o">**</span>
          <span class="n">j</span><span class="p">:]</span> <span class="o">=</span> <span class="n">rescaleWav</span><span class="p">(</span><span class="n">U</span><span class="p">[</span><span class="mi">2</span> <span class="o">**</span> <span class="n">j</span><span class="p">:</span><span class="mi">2</span> <span class="o">**</span> <span class="p">(</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):,</span> <span class="p">:</span><span class="mi">2</span> <span class="o">**</span> <span class="n">j</span><span class="p">:])</span>
        <span class="n">U</span><span class="p">[</span><span class="mi">2</span> <span class="o">**</span> <span class="n">j</span><span class="p">:</span><span class="mi">2</span> <span class="o">**</span> <span class="p">(</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):,</span> <span class="mi">2</span> <span class="o">**</span> <span class="n">j</span><span class="p">:</span><span class="mi">2</span> <span class="o">**</span> <span class="p">(</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):]</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">rescaleWav</span><span class="p">(</span><span class="n">U</span><span class="p">[</span><span class="mi">2</span> <span class="o">**</span> <span class="n">j</span><span class="p">:</span><span class="mi">2</span> <span class="o">**</span> <span class="p">(</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):,</span> <span class="mi">2</span> <span class="o">**</span> <span class="n">j</span><span class="p">:</span><span class="mi">2</span> <span class="o">**</span> <span class="p">(</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):]))</span>
    <span class="c1"># coarse scale</span>
    <span class="n">U</span><span class="p">[:</span><span class="mi">2</span> <span class="o">**</span> <span class="n">j</span><span class="p">:,</span> <span class="p">:</span><span class="mi">2</span> <span class="o">**</span> <span class="n">j</span><span class="p">:]</span> <span class="o">=</span> <span class="n">rescale</span><span class="p">(</span><span class="n">U</span><span class="p">[:</span><span class="mi">2</span> <span class="o">**</span> <span class="n">j</span><span class="p">:,</span> <span class="p">:</span><span class="mi">2</span> <span class="o">**</span> <span class="n">j</span><span class="p">:])</span>
    <span class="c1"># plot underlying image</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">U</span><span class="p">)</span>
    <span class="c1"># display crosses</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">Jmax</span><span class="p">,</span> <span class="n">Jmin</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span> <span class="o">**</span> <span class="p">(</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)],</span> <span class="p">[</span><span class="mi">2</span> <span class="o">**</span> <span class="n">j</span><span class="p">,</span> <span class="mi">2</span> <span class="o">**</span> <span class="n">j</span><span class="p">],</span> <span class="s1">&#39;b&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">2</span> <span class="o">**</span> <span class="n">j</span><span class="p">,</span> <span class="mi">2</span> <span class="o">**</span> <span class="n">j</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span> <span class="o">**</span> <span class="p">(</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)],</span> <span class="s1">&#39;b&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">U</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">PlotWavelet</span><span class="p">(</span><span class="n">WaveletTransform</span><span class="p">(</span><span class="n">cropped</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[0.39351842, 0.32848455, 0.32848455, ..., 0.49981076, 0.49954092,
        0.39466087],
       [0.32848455, 0.32848455, 0.32848455, ..., 0.5       , 0.5       ,
        0.5       ],
       [0.32848455, 0.32848455, 0.32848455, ..., 0.5       , 0.5       ,
        0.5       ],
       ...,
       [0.50051351, 0.5       , 0.5       , ..., 0.50367352, 0.50012416,
        0.49946431],
       [0.49859707, 0.5       , 0.5       , ..., 0.50454897, 0.49586309,
        0.50330812],
       [0.38217186, 0.5       , 0.5       , ..., 0.49936489, 0.49926823,
        0.63154009]])
</pre></div>
</div>
<img alt="../../_images/TP5 - Wavelets - Exercices_17_1.png" src="../../_images/TP5 - Wavelets - Exercices_17_1.png" />
</div>
</div>
</div>
<div class="section" id="q5-the-wavelet-transform-is-an-orthogonal-transformation-so-its-inverse-is-given-by-its-transpose-also-called-adjoint-use-the-two-operators-defined-below-to-implement-the-inverse-of-the-wavelet-transform">
<h2>Q5: The wavelet transform is an orthogonal transformation so its inverse is given by its transpose (also called adjoint). Use the two operators defined below to implement the inverse of the wavelet transform.<a class="headerlink" href="#q5-the-wavelet-transform-is-an-orthogonal-transformation-so-its-inverse-is-given-by-its-transpose-also-called-adjoint-use-the-two-operators-defined-below-to-implement-the-inverse-of-the-wavelet-transform" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">AdjointCoarse</span><span class="p">(</span><span class="n">image</span><span class="p">,</span><span class="n">d</span><span class="p">):</span>
    <span class="n">adjoint_h</span> <span class="o">=</span> <span class="n">reverse</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">cconv</span><span class="p">(</span><span class="n">upsampling</span><span class="p">(</span><span class="n">image</span><span class="p">,</span><span class="n">d</span><span class="p">),</span><span class="n">adjoint_h</span><span class="p">,</span><span class="n">d</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">AdjointFine</span><span class="p">(</span><span class="n">image</span><span class="p">,</span><span class="n">d</span><span class="p">):</span>
    <span class="n">adjoint_g</span> <span class="o">=</span> <span class="n">reverse</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">cconv</span><span class="p">(</span><span class="n">upsampling</span><span class="p">(</span><span class="n">image</span><span class="p">,</span><span class="n">d</span><span class="p">),</span><span class="n">adjoint_g</span><span class="p">,</span><span class="n">d</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Hereafter, you just implement the inverse of a one-step wavelet transform.</span>
<span class="k">def</span> <span class="nf">IW_0</span><span class="p">(</span><span class="n">wavelet</span><span class="p">):</span>
    <span class="c1"># you can use the temporary variables defined below.</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">wavelet</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">//</span><span class="mi">2</span>
    <span class="n">temp_hc_vc</span> <span class="o">=</span> <span class="n">wavelet</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">n</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">n</span><span class="p">]</span>
    <span class="n">temp_hc_vf</span> <span class="o">=</span> <span class="n">wavelet</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">n</span><span class="p">,</span><span class="n">n</span><span class="p">:]</span>
    <span class="n">temp_hf_vc</span> <span class="o">=</span> <span class="n">wavelet</span><span class="p">[</span><span class="n">n</span><span class="p">:,</span><span class="mi">0</span><span class="p">:</span><span class="n">n</span><span class="p">]</span>
    <span class="n">temp_hf_vf</span> <span class="o">=</span> <span class="n">wavelet</span><span class="p">[</span><span class="n">n</span><span class="p">:,</span><span class="n">n</span><span class="p">:]</span>
    
    <span class="c1"># implement here the adjoint on each directions and then on the full vector.</span>
    <span class="n">LL</span> <span class="o">=</span> <span class="n">AdjointCoarse</span><span class="p">(</span><span class="n">temp_hc_vc</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">LH</span> <span class="o">=</span> <span class="n">AdjointCoarse</span><span class="p">(</span><span class="n">temp_hf_vc</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">HL</span> <span class="o">=</span> <span class="n">AdjointFine</span><span class="p">(</span><span class="n">temp_hc_vf</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">HH</span> <span class="o">=</span> <span class="n">AdjointFine</span><span class="p">(</span><span class="n">temp_hf_vf</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">result_type</span> <span class="o">=</span> <span class="n">AdjointCoarse</span><span class="p">(</span><span class="n">LL</span> <span class="o">+</span> <span class="n">HL</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="n">AdjointFine</span><span class="p">(</span><span class="n">LH</span> <span class="o">+</span> <span class="n">HH</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result_type</span>

<span class="c1"># once the function above is implemented, the full wavelet inversion reads like this:</span>
<span class="k">def</span> <span class="nf">IWT</span><span class="p">(</span><span class="n">wavelet</span><span class="p">,</span><span class="n">iterations</span> <span class="o">=</span> <span class="mi">3</span><span class="p">):</span>
    <span class="n">image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">wavelet</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">reverse</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">iterations</span><span class="p">)):</span>
        <span class="n">cut</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">wavelet</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">//</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="n">i</span><span class="p">)</span>
        <span class="n">image</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">cut</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">cut</span><span class="p">]</span> <span class="o">=</span> <span class="n">IW_0</span><span class="p">(</span><span class="n">image</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">cut</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">cut</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">image</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="q6-test-on-an-image-that-the-implemented-inverse-is-correct-that-is-check-on-an-image-x-that-iwt-text-wavelettransform-x-x-up-to-numerical-errors">
<h2>Q6: Test on an image that the implemented inverse is correct. That is, check on an image <span class="math notranslate nohighlight">\(x\)</span> that <span class="math notranslate nohighlight">\(IWT(\text{WaveletTransform(x)}) = x\)</span> up to numerical errors.<a class="headerlink" href="#q6-test-on-an-image-that-the-implemented-inverse-is-correct-that-is-check-on-an-image-x-that-iwt-text-wavelettransform-x-x-up-to-numerical-errors" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">waveletTransform</span> <span class="o">=</span> <span class="n">WaveletTransform</span><span class="p">(</span><span class="n">cropped</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> 
<span class="n">iwv</span> <span class="o">=</span> <span class="n">IWT</span><span class="p">(</span><span class="n">waveletTransform</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>

<span class="c1"># Original</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Grey Level Image &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">cropped</span><span class="p">)))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">cropped</span><span class="p">)</span>

<span class="c1"># Wavelet transform</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Wavelet transform&quot;</span><span class="p">)</span>
<span class="n">PlotWavelet</span><span class="p">(</span><span class="n">waveletTransform</span><span class="p">)</span>

<span class="c1"># Inverted</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Inverse&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">iwv</span><span class="p">)</span>

<span class="n">waveletTransform</span> <span class="o">=</span> <span class="n">WaveletTransform</span><span class="p">(</span><span class="n">cropped</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> 
<span class="n">iwv</span> <span class="o">=</span> <span class="n">IWT</span><span class="p">(</span><span class="n">waveletTransform</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>

<span class="c1"># Original</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Grey Level Image &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">cropped</span><span class="p">)))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">cropped</span><span class="p">)</span>

<span class="c1"># Wavelet transform</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Wavelet transform&quot;</span><span class="p">)</span>
<span class="n">PlotWavelet</span><span class="p">(</span><span class="n">waveletTransform</span><span class="p">)</span>

<span class="c1"># Inverted</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Inverse&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">iwv</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;diff between original and recovered:&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">cropped</span><span class="o">-</span><span class="n">iwv</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>diff between original and recovered: 134730229.40767026
</pre></div>
</div>
<img alt="../../_images/TP5 - Wavelets - Exercices_22_1.png" src="../../_images/TP5 - Wavelets - Exercices_22_1.png" />
<img alt="../../_images/TP5 - Wavelets - Exercices_22_2.png" src="../../_images/TP5 - Wavelets - Exercices_22_2.png" />
</div>
</div>
<p>Funny how it acts with a different number of iterations, the inverse is done and the image of the top-left corner in the wavelet transform disapear.</p>
<p>Use of wavelets for compression.</p>
</div>
<div class="section" id="q7-plot-the-histogram-of-the-wavelet-coefficients-just-to-see-the-repartition-between-small-and-large-coefficients-by-modifying-the-code-below-you-should-see-that-most-of-the-coefficients-are-close-to-0-and-few-are-large-coefficients-thus-the-idea-is-that-lossy-compression-might-perform-well-on-this-data">
<h2>Q7: Plot the histogram of the wavelet coefficients just to see the repartition between small and large coefficients by modifying the code below. You should see that most of the coefficients are close to <span class="math notranslate nohighlight">\(0\)</span> and few are large coefficients. Thus, the idea is that lossy compression might perform well on this data.<a class="headerlink" href="#q7-plot-the-histogram-of-the-wavelet-coefficients-just-to-see-the-repartition-between-small-and-large-coefficients-by-modifying-the-code-below-you-should-see-that-most-of-the-coefficients-are-close-to-0-and-few-are-large-coefficients-thus-the-idea-is-that-lossy-compression-might-perform-well-on-this-data" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">temp</span> <span class="o">=</span> <span class="n">waveletTransform</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="kn">import</span> <span class="nn">pylab</span> <span class="k">as</span> <span class="nn">pl</span>
<span class="n">pl</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span><span class="n">bins</span> <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">200</span><span class="p">,</span><span class="mi">100</span><span class="p">))</span>
<span class="n">temp</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">temp</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">temp</span><span class="p">[</span><span class="mi">500</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1048576
-143.2512625397739
</pre></div>
</div>
<img alt="../../_images/TP5 - Wavelets - Exercices_26_1.png" src="../../_images/TP5 - Wavelets - Exercices_26_1.png" />
</div>
</div>
</div>
<div class="section" id="q8-consider-the-20-largest-coefficients-of-the-wavelet-transform-and-put-all-the-remaining-coefficients-to-0-and-show-the-resulting-approximating-image">
<h2>Q8: Consider the 20% largest coefficients of the wavelet transform and put all the remaining coefficients to <span class="math notranslate nohighlight">\(0\)</span> and show the resulting approximating image.<a class="headerlink" href="#q8-consider-the-20-largest-coefficients-of-the-wavelet-transform-and-put-all-the-remaining-coefficients-to-0-and-show-the-resulting-approximating-image" title="Permalink to this headline">¶</a></h2>
<p>Do the same with Fourier transform by calling the <span class="math notranslate nohighlight">\(fft2\)</span> function and compare visually and compare using the function implemented below which is the signal to noise ratio function.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">scipy.fftpack</span> <span class="k">as</span> <span class="nn">sf</span>

<span class="k">def</span> <span class="nf">snr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="n">s</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">y</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">s</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;Equal inputs&quot;</span>
    <span class="k">return</span> <span class="mi">20</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">/</span><span class="n">s</span><span class="p">)</span>

<span class="n">iwv</span> <span class="o">=</span> <span class="n">real</span><span class="p">(</span><span class="n">sf</span><span class="o">.</span><span class="n">fft2</span><span class="p">(</span><span class="n">waveletTransform</span><span class="p">))</span>

<span class="c1"># Plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>

<span class="c1"># Original</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Grey Level Image &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">cropped</span><span class="p">)))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">cropped</span><span class="p">)</span>

<span class="c1"># Wavelet transform</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Wavelet transform&quot;</span><span class="p">)</span>
<span class="n">PlotWavelet</span><span class="p">(</span><span class="n">waveletTransform</span><span class="p">)</span>

<span class="c1"># FFT2</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;FFT2&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">iwv</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.image.AxesImage at 0x7f66e8839450&gt;
</pre></div>
</div>
<img alt="../../_images/TP5 - Wavelets - Exercices_28_1.png" src="../../_images/TP5 - Wavelets - Exercices_28_1.png" />
</div>
</div>
<p>Last note that one can look at the wavelet function by plotting the image of a Dirac mass. Run and play with the code below.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n</span> <span class="o">=</span> <span class="mi">32</span>
<span class="n">dirac</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n</span><span class="p">,</span><span class="n">n</span><span class="p">))</span>
<span class="n">dirac</span><span class="p">[</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">ondelette</span> <span class="o">=</span> <span class="n">IW_0</span><span class="p">(</span><span class="n">dirac</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">ondelette</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.image.AxesImage at 0x7f66e87c34d0&gt;
</pre></div>
</div>
<img alt="../../_images/TP5 - Wavelets - Exercices_30_1.png" src="../../_images/TP5 - Wavelets - Exercices_30_1.png" />
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./TD/TD5"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        
    <a class='left-prev' id="prev-link" href="../TD4/TP4%20-%20Spectral%20Analysis%20and%20Filtering-Exercise.html" title="previous page">TD4 - Spectral Analysis and Filtering</a>
    <a class='right-next' id="next-link" href="../TD6/Inverse-Problem.html" title="next page">Inverse Problem</a>

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By IMAC Students<br/>
        
            &copy; Copyright 2020.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    
  <script src="../../_static/js/index.3da636dd464baa7582d2.js"></script>


    
  </body>
</html>