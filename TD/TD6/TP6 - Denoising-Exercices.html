
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>TD6 - Denoising &#8212; M2 Signal classes</title>
    
  <link rel="stylesheet" href="../../_static/css/index.73d71520a4ca3b99cfee5594769eaaae.css">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="../../_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="../../_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/sphinx-book-theme.40e2e510f6b7d1648584402491bb10fe.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../../_static/js/index.3da636dd464baa7582d2.js">

    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/togglebutton.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/sphinx-book-theme.d31b09fe5c1d09cb49b26a786de4a05d.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="TD7 - Optimization" href="../TD7/TP7%20-%20Optimization.html" />
    <link rel="prev" title="Inverse Problem" href="Inverse-Problem.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../../index.html">
  
  <img src="../../_static/logo.png" class="logo" alt="logo">
  
  
  <h1 class="site-logo" id="site-title">M2 Signal classes</h1>
  
</a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>
<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../../Introduction/Introduction.html">
   Introduction
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Fourier
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../../Transform%C3%A9e%20de%20Fourier/Transform%C3%A9e%20de%20Fourier.html">
   Transformée de Fourier
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Filtrage
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../../Filtrage/Filtre.html">
   Filtre
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../Filtrage/D%C3%A9bruitage.html">
   Débruitage
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Compression
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../../Compression/Compression.html">
   Compression
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../Compression/Le%20cas%20du%20JPEG.html">
   Le cas du JPEG
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../Compression/Ondelettes.html">
   Ondelettes
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  TD
 </span>
</p>
<ul class="current nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../TD1/TP1%20-%20EEA%20-%20Exercices.html">
   TD1 - Analyse en fréquence de signaux sonores.
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../TD2/TP2%20-%20FFT%20-%20Exercices.html">
   TD2 - FFT
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../TD3/TP3%20-%20Compression%20Shannon-Huffman-Exercises.html">
   TD3 - Compression Shannon-Huffman
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../TD4/TP4%20-%20Spectral%20Analysis%20and%20Filtering-Exercise.html">
   TD4 - Spectral Analysis and Filtering
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../TD5/TP5%20-%20Wavelets%20-%20Exercices.html">
   TD5 - Wavelets
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Inverse-Problem.html">
   Inverse Problem
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   TD6 - Denoising
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../TD7/TP7%20-%20Optimization.html">
   TD7 - Optimization
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../TD8/TP8%20-%20Non-local%20means-exercises.html">
   TD8 - Non-local means
  </a>
 </li>
</ul>

</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
            data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
            aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
            title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../_sources/TD/TD6/TP6 - Denoising-Exercices.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

        <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/IMAC-projects/M2-SIS-signal"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/IMAC-projects/M2-SIS-signal/issues/new?title=Issue%20on%20page%20%2FTD/TD6/TP6 - Denoising-Exercices.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>


        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
                title="Fullscreen mode"><i
                    class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/IMAC-projects/M2-SIS-signal/master?urlpath=tree/TD/TD6/TP6 - Denoising-Exercices.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

    </div>

    <!-- Table of contents -->
    <div class="d-none d-md-block col-md-2 bd-toc show">
        
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i> Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#q1-compare-the-results-of-this-denoiser-when-varying-the-standard-deviation-of-the-filter-for-that-you-can-use-the-signal-to-noise-ratio-implemented-above-to-compare-the-results-vary-the-noise-level-and-show-the-optimal-denoised-result">
   Q1: Compare the results of this denoiser when varying the standard deviation of the filter. For that you can use the signal to noise ratio implemented above to compare the results. Vary the noise level and show the optimal denoised result.
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#q2-implement-the-denoiser-associated-with-the-hard-thresholding-method-for-the-fourier-basis-and-show-the-best-result">
   Q2: Implement the denoiser associated with the hard-thresholding method for the Fourier basis and show the best result.
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#q3-implement-the-hard-thresholding-for-the-wavelet-transform-and-select-the-best-result">
   Q3: Implement the hard-thresholding for the wavelet transform and select the best result.
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#q4-implement-the-cycle-spinning-scheme-for-hard-thresholding-for-the-wavelet-transform-and-select-the-best-result">
   Q4: Implement the cycle spinning scheme for hard-thresholding for the wavelet transform and select the best result.
  </a>
 </li>
</ul>

        </nav>
        
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="td6-denoising">
<h1>TD6 - Denoising<a class="headerlink" href="#td6-denoising" title="Permalink to this headline">¶</a></h1>
<p>In this TD, we consider simple denoising algorithms, such as the ones considered in the lectures.</p>
<p>We implement the four following methods:</p>
<ol class="simple">
<li><p>Use of a high-pass filter as a Gaussian and select experimentally the best standard deviation.</p></li>
<li><p>Use of hard-thresholding in the Fourier basis and select the best threshold.</p></li>
<li><p>Use of hard-thresholding in the Wavelet basis and select the best threshold.</p></li>
<li><p>Use of cycle-spinning and hard-thresholding in wavelet basis.</p></li>
<li><p>Replace hard with soft-thresholding in the previous experiments.</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">division</span>
<span class="kn">import</span> <span class="nn">scipy.misc</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">scipy</span> <span class="k">as</span> <span class="nn">sp</span>
<span class="kn">import</span> <span class="nn">scipy.fftpack</span> <span class="k">as</span> <span class="nn">ft</span>
<span class="kn">import</span> <span class="nn">imageio</span>
<span class="o">%</span><span class="k">pylab</span> inline
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Populating the interactive namespace from numpy and matplotlib
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># load an image</span>
<span class="kn">import</span> <span class="nn">imageio</span> <span class="k">as</span> <span class="nn">imio</span>
<span class="n">colored_image</span> <span class="o">=</span> <span class="n">imio</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="s1">&#39;toits.jpg&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">colored_image</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">n</span> <span class="o">=</span> <span class="n">colored_image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span>
<span class="n">n</span> <span class="o">=</span> <span class="mi">512</span>
<span class="n">image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">colored_image</span><span class="o">*</span><span class="p">[</span><span class="mf">0.21</span><span class="p">,</span> <span class="mf">0.72</span> <span class="p">,</span><span class="mf">0.07</span><span class="p">],</span><span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)[:</span><span class="n">n</span><span class="p">,</span><span class="mi">200</span><span class="p">:</span><span class="mi">200</span><span class="o">+</span><span class="n">n</span><span class="p">]</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gray</span><span class="p">()</span>
<span class="c1">#cropped = image[n:n+64,n:n + 64]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot; Grey Level Image &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">image</span><span class="p">)))</span>
<span class="n">cropped</span> <span class="o">=</span> <span class="n">image</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">colored_image</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">cropped</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">cropped</span><span class="p">),(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">cropped</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">image0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(633, 950, 3)
122.32328414916992 46.80025028089334 0.0
(512, 512)
</pre></div>
</div>
<img alt="../../_images/TP6 - Denoising-Exercices_3_1.png" src="../../_images/TP6 - Denoising-Exercices_3_1.png" />
</div>
</div>
<p>Below are implemented the Gaussian noise and a version of the salt noise. The generative model is thus
\begin{equation}
I_{\text{observed}} = I_{true} + \text{GaussianNoise},.
\end{equation}
A denoiser is a map <span class="math notranslate nohighlight">\(\text{Denoise}\)</span> that takes as input an image and output an image. It can be a linear map as in the case of the gaussian smoothing (first method you have to implement). Or, it can be a non-linear method as the case of hard-thresholding.</p>
<p>In order to select a good value (of the standard deviation in the case of the gaussian denoiser, or the threshold for the hard-thresholding method) for the denoisers, we propose to use the SNR function implemented below.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">snr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="n">s</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">y</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">s</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;Equal inputs&quot;</span>
    <span class="k">return</span> <span class="mi">20</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">/</span><span class="n">s</span><span class="p">)</span>

<span class="c1">#signal divisé par bruit donc il faut qu&#39;il soit grand</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## Add some noise to the image</span>
<span class="k">def</span> <span class="nf">clamp</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="n">temp</span> <span class="o">=</span>  <span class="mi">255</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="o">&gt;</span><span class="mi">255</span><span class="p">)</span> <span class="o">+</span> <span class="n">x</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span><span class="o">&lt;</span><span class="mi">255</span><span class="p">)</span> 
    <span class="k">return</span> <span class="n">temp</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">GaussianNoise</span><span class="p">(</span><span class="n">image</span><span class="p">,</span><span class="n">sigma</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">clamp</span><span class="p">(</span><span class="n">image</span> <span class="o">+</span> <span class="n">sigma</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

<span class="k">def</span> <span class="nf">SaltNoise</span><span class="p">(</span><span class="n">image</span><span class="p">,</span><span class="n">sigma</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">clamp</span><span class="p">(</span><span class="n">image</span> <span class="o">+</span> <span class="n">sigma</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">))</span>

<span class="n">sigma</span> <span class="o">=</span> <span class="mf">10.0</span>
<span class="n">noisy_image</span>  <span class="o">=</span> <span class="n">clamp</span><span class="p">(</span><span class="n">image</span> <span class="o">+</span> <span class="n">sigma</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">noisy_image</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">noisy_image</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>-0.0
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.image.AxesImage at 0x7f42e3a7df10&gt;
</pre></div>
</div>
<img alt="../../_images/TP6 - Denoising-Exercices_6_2.png" src="../../_images/TP6 - Denoising-Exercices_6_2.png" />
</div>
</div>
<p>Below is implemented a convolution and the Gaussian filter.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cconv1</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span> <span class="p">:</span> <span class="n">real</span><span class="p">(</span><span class="n">ifft2</span><span class="p">(</span><span class="n">fft2</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">*</span><span class="n">fft2</span><span class="p">(</span><span class="n">b</span><span class="p">)))</span>
<span class="n">normalize</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">h</span> <span class="p">:</span> <span class="n">h</span><span class="o">/</span><span class="nb">sum</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">transpose</span><span class="p">(</span> <span class="n">concatenate</span><span class="p">(</span> <span class="p">(</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">n</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span> <span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="n">n</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="p">)</span> <span class="p">)</span> <span class="p">)</span>
<span class="p">[</span><span class="n">Y</span><span class="p">,</span><span class="n">X</span><span class="p">]</span> <span class="o">=</span> <span class="n">meshgrid</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
<span class="n">hh</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">mu</span><span class="p">:</span> <span class="n">normalize</span><span class="p">(</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">X</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">Y</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">mu</span><span class="o">**</span><span class="mi">2</span><span class="p">)))</span>
<span class="n">mu</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">fftshift</span><span class="p">(</span><span class="n">hh</span><span class="p">(</span><span class="n">mu</span><span class="p">)))</span>
<span class="n">title</span><span class="p">(</span><span class="s1">&#39;h&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">fftshift</span><span class="p">(</span><span class="n">real</span><span class="p">(</span><span class="n">fft2</span><span class="p">(</span><span class="n">hh</span><span class="p">(</span><span class="n">mu</span><span class="p">)))))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;$\hat h$&#39;</span><span class="p">);</span>

<span class="c1">### Here we implement the denoiser associated with this smoothing.</span>
<span class="n">denoise</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span><span class="n">mu</span> <span class="p">:</span> <span class="n">cconv1</span><span class="p">(</span><span class="n">hh</span><span class="p">(</span><span class="n">mu</span><span class="p">),</span> <span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/TP6 - Denoising-Exercices_8_0.png" src="../../_images/TP6 - Denoising-Exercices_8_0.png" />
</div>
</div>
<div class="section" id="q1-compare-the-results-of-this-denoiser-when-varying-the-standard-deviation-of-the-filter-for-that-you-can-use-the-signal-to-noise-ratio-implemented-above-to-compare-the-results-vary-the-noise-level-and-show-the-optimal-denoised-result">
<h2>Q1: Compare the results of this denoiser when varying the standard deviation of the filter. For that you can use the signal to noise ratio implemented above to compare the results. Vary the noise level and show the optimal denoised result.<a class="headerlink" href="#q1-compare-the-results-of-this-denoiser-when-varying-the-standard-deviation-of-the-filter-for-that-you-can-use-the-signal-to-noise-ratio-implemented-above-to-compare-the-results-vary-the-noise-level-and-show-the-optimal-denoised-result" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">snrValues</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">aRange</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mf">0.2</span><span class="p">)</span>

<span class="k">for</span> <span class="n">mu</span> <span class="ow">in</span> <span class="n">aRange</span><span class="p">:</span>
    <span class="n">denoised</span> <span class="o">=</span> <span class="n">denoise</span><span class="p">(</span><span class="n">noisy_image</span><span class="p">,</span><span class="n">mu</span><span class="p">)</span>
    <span class="n">snrValues</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">snr</span><span class="p">(</span><span class="n">noisy_image</span><span class="p">,</span> <span class="n">denoised</span><span class="p">),</span><span class="mi">4</span><span class="p">))</span>
    
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">131</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">noisy_image</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">132</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">denoised</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.image.AxesImage at 0x7f42e3115550&gt;
</pre></div>
</div>
<img alt="../../_images/TP6 - Denoising-Exercices_10_1.png" src="../../_images/TP6 - Denoising-Exercices_10_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">snrMin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">snrValues</span><span class="p">)</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
<span class="n">snrMax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">snrValues</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">snrValues</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/TP6 - Denoising-Exercices_11_0.png" src="../../_images/TP6 - Denoising-Exercices_11_0.png" />
</div>
</div>
<p>Below is plotted the graph of the hard-thresholding function that you are going to apply to different descriptions of the image:</p>
<ol class="simple">
<li><p>In the Fourier basis,</p></li>
<li><p>In the wavelet basis.</p></li>
</ol>
<p>We also propose the soft-thresholding implemented below.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">HardThresholding</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="n">t</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">u</span><span class="o">*</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="o">&gt;</span><span class="n">t</span><span class="p">)</span>
<span class="n">alpha</span> <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1000</span><span class="p">)</span>
<span class="n">plot</span><span class="p">(</span><span class="n">alpha</span><span class="p">,</span> <span class="n">HardThresholding</span><span class="p">(</span><span class="n">alpha</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
<span class="n">axis</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/TP6 - Denoising-Exercices_13_0.png" src="../../_images/TP6 - Denoising-Exercices_13_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">SoftThresholding</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="n">t</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">maximum</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">t</span><span class="o">/</span><span class="nb">abs</span><span class="p">(</span><span class="n">u</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span><span class="o">*</span><span class="n">u</span>
<span class="n">alpha</span> <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1000</span><span class="p">)</span>
<span class="n">plot</span><span class="p">(</span><span class="n">alpha</span><span class="p">,</span> <span class="n">SoftThresholding</span><span class="p">(</span><span class="n">alpha</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
<span class="n">axis</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/TP6 - Denoising-Exercices_14_0.png" src="../../_images/TP6 - Denoising-Exercices_14_0.png" />
</div>
</div>
</div>
<div class="section" id="q2-implement-the-denoiser-associated-with-the-hard-thresholding-method-for-the-fourier-basis-and-show-the-best-result">
<h2>Q2: Implement the denoiser associated with the hard-thresholding method for the Fourier basis and show the best result.<a class="headerlink" href="#q2-implement-the-denoiser-associated-with-the-hard-thresholding-method-for-the-fourier-basis-and-show-the-best-result" title="Permalink to this headline">¶</a></h2>
<p>Below is implemented the wavelet transform using the Daubechies 4 filters and its inverse.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">h</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">.</span><span class="mi">482962913145</span><span class="p">,</span> <span class="o">.</span><span class="mi">836516303738</span><span class="p">,</span> <span class="o">.</span><span class="mi">224143868042</span><span class="p">,</span> <span class="o">-.</span><span class="mi">129409522551</span><span class="p">]</span>
<span class="n">h</span> <span class="o">=</span> <span class="n">h</span><span class="o">/</span><span class="n">norm</span><span class="p">(</span><span class="n">h</span><span class="p">)</span> <span class="c1">## make sure the filter has norm 1.</span>
<span class="n">u</span> <span class="o">=</span> <span class="n">power</span><span class="p">(</span><span class="o">-</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">h</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">h</span><span class="p">)))</span> <span class="c1"># alternate +1/-1</span>
<span class="n">g</span> <span class="o">=</span> <span class="n">concatenate</span><span class="p">(([</span><span class="mi">0</span><span class="p">],</span> <span class="n">h</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">u</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">cconv</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Circular convolution along dimension d.</span>
<span class="sd">        len(h) must be  odd.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">d</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">cconv</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">h</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="n">p</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
    <span class="n">pc</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span> <span class="nb">float</span><span class="p">((</span><span class="n">p</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="p">)))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">y</span> <span class="o">+</span> <span class="n">h</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">pc</span><span class="o">-</span><span class="n">i</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">y</span>

<span class="k">def</span> <span class="nf">subsampling</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
    <span class="n">p</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="k">if</span> <span class="n">d</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">x</span><span class="p">[::</span><span class="n">p</span><span class="p">,</span> <span class="p">:]</span>
    <span class="k">elif</span> <span class="n">d</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">x</span><span class="p">[:,</span> <span class="p">::</span><span class="n">p</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">y</span>


<span class="k">def</span> <span class="nf">upsampling</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
    <span class="n">p</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span>
    <span class="k">if</span> <span class="n">d</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">p</span> <span class="o">*</span> <span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">y</span><span class="p">[::</span><span class="n">p</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">x</span>
    <span class="k">elif</span> <span class="n">d</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p</span> <span class="o">*</span> <span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">y</span><span class="p">[:,</span> <span class="p">::</span><span class="n">p</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span>
    <span class="k">return</span> <span class="n">y</span>

<span class="k">def</span> <span class="nf">reverse</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="k">def</span> <span class="nf">coarse</span><span class="p">(</span><span class="n">image</span><span class="p">,</span><span class="n">d</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">subsampling</span><span class="p">(</span><span class="n">cconv</span><span class="p">(</span><span class="n">image</span><span class="p">,</span><span class="n">h</span><span class="p">,</span><span class="n">d</span><span class="p">),</span><span class="n">d</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">fine</span><span class="p">(</span><span class="n">image</span><span class="p">,</span><span class="n">d</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">subsampling</span><span class="p">(</span><span class="n">cconv</span><span class="p">(</span><span class="n">image</span><span class="p">,</span><span class="n">g</span><span class="p">,</span><span class="n">d</span><span class="p">),</span><span class="n">d</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">W_0</span><span class="p">(</span><span class="n">image</span><span class="p">,</span><span class="n">wavelet_coeff</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">temp_hc</span> <span class="o">=</span> <span class="n">coarse</span><span class="p">(</span><span class="n">image</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">temp_hf</span> <span class="o">=</span> <span class="n">fine</span><span class="p">(</span><span class="n">image</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
    
    <span class="n">temp_hc_vc</span> <span class="o">=</span> <span class="n">coarse</span><span class="p">(</span><span class="n">temp_hc</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">temp_hc_vf</span> <span class="o">=</span> <span class="n">fine</span><span class="p">(</span><span class="n">temp_hc</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">temp_hf_vc</span> <span class="o">=</span> <span class="n">coarse</span><span class="p">(</span><span class="n">temp_hf</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">temp_hf_vf</span> <span class="o">=</span> <span class="n">fine</span><span class="p">(</span><span class="n">temp_hf</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
    
    <span class="n">temp1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span> <span class="p">(</span><span class="n">temp_hc_vc</span><span class="p">,</span> <span class="n">temp_hc_vf</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span> <span class="p">)</span>
    <span class="n">temp2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span> <span class="p">(</span><span class="n">temp_hf_vc</span><span class="p">,</span> <span class="n">temp_hf_vf</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span> <span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">temp1</span><span class="p">,</span><span class="n">temp2</span><span class="p">),</span><span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">WaveletTransform</span><span class="p">(</span><span class="n">image</span><span class="p">,</span><span class="n">iterations</span> <span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="n">initial_size</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">image</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">wavelet_transform</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
    
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">iterations</span><span class="p">):</span>
        <span class="n">cut</span> <span class="o">=</span> <span class="n">initial_size</span><span class="o">//</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="n">i</span><span class="p">)</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">wavelet_transform</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">cut</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">cut</span><span class="p">])</span>
        <span class="n">wavelet_transform</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">cut</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">cut</span><span class="p">]</span> <span class="o">=</span> <span class="n">W_0</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">wavelet_transform</span>

<span class="k">def</span> <span class="nf">AdjointCoarse</span><span class="p">(</span><span class="n">image</span><span class="p">,</span><span class="n">d</span><span class="p">):</span>
    <span class="n">adjoint_h</span> <span class="o">=</span> <span class="n">reverse</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">cconv</span><span class="p">(</span><span class="n">upsampling</span><span class="p">(</span><span class="n">image</span><span class="p">,</span><span class="n">d</span><span class="p">),</span><span class="n">adjoint_h</span><span class="p">,</span><span class="n">d</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">AdjointFine</span><span class="p">(</span><span class="n">image</span><span class="p">,</span><span class="n">d</span><span class="p">):</span>
    <span class="n">adjoint_g</span> <span class="o">=</span> <span class="n">reverse</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">cconv</span><span class="p">(</span><span class="n">upsampling</span><span class="p">(</span><span class="n">image</span><span class="p">,</span><span class="n">d</span><span class="p">),</span><span class="n">adjoint_g</span><span class="p">,</span><span class="n">d</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">IW_0</span><span class="p">(</span><span class="n">wavelet</span><span class="p">):</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">wavelet</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">//</span><span class="mi">2</span>
    <span class="n">temp_hc_vc</span> <span class="o">=</span> <span class="n">wavelet</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">n</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">n</span><span class="p">]</span>
    <span class="n">temp_hc_vf</span> <span class="o">=</span> <span class="n">wavelet</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">n</span><span class="p">,</span><span class="n">n</span><span class="p">:]</span>
    <span class="n">temp_hf_vc</span> <span class="o">=</span> <span class="n">wavelet</span><span class="p">[</span><span class="n">n</span><span class="p">:,</span><span class="mi">0</span><span class="p">:</span><span class="n">n</span><span class="p">]</span>
    <span class="n">temp_hf_vf</span> <span class="o">=</span> <span class="n">wavelet</span><span class="p">[</span><span class="n">n</span><span class="p">:,</span><span class="n">n</span><span class="p">:]</span>
    
    <span class="n">temp_hc</span> <span class="o">=</span> <span class="n">AdjointCoarse</span><span class="p">(</span><span class="n">temp_hc_vc</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">AdjointFine</span><span class="p">(</span><span class="n">temp_hc_vf</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">temp_hf</span> <span class="o">=</span> <span class="n">AdjointCoarse</span><span class="p">(</span><span class="n">temp_hf_vc</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">AdjointFine</span><span class="p">(</span><span class="n">temp_hf_vf</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
    
    <span class="n">result</span> <span class="o">=</span> <span class="n">AdjointCoarse</span><span class="p">(</span><span class="n">temp_hc</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="o">+</span><span class="n">AdjointFine</span><span class="p">(</span><span class="n">temp_hf</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">result</span>



<span class="k">def</span> <span class="nf">IWT</span><span class="p">(</span><span class="n">wavelet</span><span class="p">,</span><span class="n">iterations</span> <span class="o">=</span> <span class="mi">3</span><span class="p">):</span>
    
    <span class="n">image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">wavelet</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">reverse</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">iterations</span><span class="p">)):</span>
        <span class="n">cut</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">wavelet</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">//</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="n">i</span><span class="p">)</span>
        <span class="n">image</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">cut</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">cut</span><span class="p">]</span> <span class="o">=</span> <span class="n">IW_0</span><span class="p">(</span><span class="n">image</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">cut</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">cut</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">image</span>
    
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="q3-implement-the-hard-thresholding-for-the-wavelet-transform-and-select-the-best-result">
<h2>Q3: Implement the hard-thresholding for the wavelet transform and select the best result.<a class="headerlink" href="#q3-implement-the-hard-thresholding-for-the-wavelet-transform-and-select-the-best-result" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="q4-implement-the-cycle-spinning-scheme-for-hard-thresholding-for-the-wavelet-transform-and-select-the-best-result">
<h2>Q4: Implement the cycle spinning scheme for hard-thresholding for the wavelet transform and select the best result.<a class="headerlink" href="#q4-implement-the-cycle-spinning-scheme-for-hard-thresholding-for-the-wavelet-transform-and-select-the-best-result" title="Permalink to this headline">¶</a></h2>
<p>## Q5: Replace hard-thresholding with soft and re-run the different denoising methods that used previously hard-thresholding. What is the best method on this particular image ?</p>
<p>## Q6: Open question: in the previous experiments, the original image was known and it was thus direct to select the best parameter. Can you propose a method to select the optimal parameters when the original image is not known?</p>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./TD/TD6"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        
    <a class='left-prev' id="prev-link" href="Inverse-Problem.html" title="previous page">Inverse Problem</a>
    <a class='right-next' id="next-link" href="../TD7/TP7%20-%20Optimization.html" title="next page">TD7 - Optimization</a>

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By IMAC Students<br/>
        
            &copy; Copyright 2020.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    
  <script src="../../_static/js/index.3da636dd464baa7582d2.js"></script>


    
  </body>
</html>